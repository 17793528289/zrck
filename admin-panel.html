<!DOCTYPE html>
<html>
<head>
  <title>用户管理系统</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    button { padding: 8px 12px; margin: 5px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ddd; padding: 8px; }
  </style>
</head>
<body>
  <h1>用户管理系统</h1>
  
  <div>
    <h2>添加用户</h2>
    <input id="username" placeholder="用户名">
    <input id="password" placeholder="密码">
    <button onclick="addUser()">添加</button>
  </div>

  <div>
    <h2>用户列表</h2>
    <table id="userTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>用户名</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    // 初始化Supabase
    const supabaseUrl = 'https://wxbemuwgiiucdgmbhbvg.supabase.co';
    const supabaseKey = 'sb_publishable_KuzTRmYOZ9P6UmKgmb_VwA_6Qj_A6Nk';
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    // 加载用户列表
    async function loadUsers() {
      const { data, error } = await supabase
        .from('users')
        .select('*');
      
      if (error) {
        console.error('加载用户失败:', error);
        return;
      }
      
      const tbody = document.querySelector('#userTable tbody');
      tbody.innerHTML = '';
      
      data.forEach(user => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${user.id}</td>
          <td>${user.username}</td>
          <td>
            <button onclick="updateUser('${user.id}')">更新</button>
            <button onclick="deleteUser('${user.id}')">删除</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // 添加用户
    async function addUser() {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      
      const { error } = await supabase
        .from('users')
        .insert([{ username, password }]);
      
      if (error) {
        alert('添加失败: ' + error.message);
        return;
      }
      
      alert('用户添加成功');
      loadUsers();
    }

    // 更新用户
    async function updateUser(id) {
      const newPassword = prompt('输入新密码');
      if (!newPassword) return;
      
      const { error } = await supabase
        .from('users')
        .update({ password: newPassword })
        .eq('id', id);
      
      if (error) {
        alert('更新失败: ' + error.message);
        return;
      }
      
      alert('密码已更新');
      loadUsers();
    }

    // 删除用户
    async function deleteUser(id) {
      if (!confirm('确定删除这个用户吗？')) return;
      
      const { error } = await supabase
        .from('users')
        .delete()
        .eq('id', id);
      
      if (error) {
        alert('删除失败: ' + error.message);
        return;
      }
      
      alert('用户已删除');
      loadUsers();
    }

    // 页面加载时初始化
    loadUsers();
  </script>
</body>
</html>
