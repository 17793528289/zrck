<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å‘˜é¢æ¿ - å“ç„¶åˆ›å®¢ç¤¾å›¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .admin-header {
            background: #2c3e50;
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .admin-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .logout-btn:hover {
            background: #c0392b;
        }
        
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .welcome-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #3498db;
            display: block;
        }
        
        .admin-sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 2rem;
        }
        
        .section-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .section-card h3 {
            color: #2c3e50;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #3498db;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        textarea {
            width: 100%;
            height: 150px;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Microsoft YaHei', monospace;
            font-size: 0.9rem;
            resize: vertical;
            margin-bottom: 1rem;
        }
        
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            margin: 0.5rem 0.5rem 0.5rem 0;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .btn-success {
            background: #27ae60;
        }
        
        .btn-success:hover {
            background: #219a52;
        }
        
        .btn-danger {
            background: #e74c3c;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-warning {
            background: #f39c12;
        }
        
        .btn-warning:hover {
            background: #e67e22;
        }
        
        .user-list {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 1rem;
            border: 1px solid #eee;
            border-radius: 5px;
        }
        
        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #eee;
            transition: background 0.3s;
        }
        
        .user-item:hover {
            background: #f8f9fa;
        }
        
        .user-item:last-child {
            border-bottom: none;
        }
        
        .user-info {
            flex: 1;
        }
        
        .user-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .action-btn {
            padding: 0.3rem 0.8rem;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
        }
        
        .search-box {
            margin-bottom: 1rem;
        }
        
        .search-box input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .message {
            padding: 0.75rem;
            border-radius: 5px;
            margin: 1rem 0;
            display: none;
        }
        
        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .message.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .import-format {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .import-format code {
            background: #e9ecef;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: monospace;
            display: inline-block;
            margin: 0.2rem 0;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #555;
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 1rem 0;
        }
        
        .quick-btn {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .quick-btn:hover {
            background: #7f8c8d;
        }
    </style>
</head>
<body>
    <!-- ç®¡ç†å‘˜å¤´éƒ¨ -->
    <header class="admin-header">
        <h1>å“ç„¶åˆ›å®¢ç¤¾å›¢ - è´¦å·ç®¡ç†ç³»ç»Ÿ</h1>
        <div class="admin-info">
            <span id="adminWelcome">æ¬¢è¿ï¼Œç®¡ç†å‘˜</span>
            <button class="logout-btn" onclick="logout()">é€€å‡ºç™»å½•</button>
        </div>
    </header>

    <!-- ä¸»è¦å†…å®¹ -->
    <div class="admin-container">
        <!-- æ¬¢è¿æ¨ªå¹… -->
        <div class="welcome-banner">
            <h2 id="mainWelcome">ç®¡ç†å‘˜æ§åˆ¶å°</h2>
            <p>ç®¡ç†ç³»ç»Ÿè´¦å·å’Œæƒé™ | ç™»å½•æ—¶é—´: <span id="loginTime"></span></p>
        </div>
        
        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <div class="stats-grid">
            <div class="stat-card">
                <span class="stat-number" id="totalUsers">0</span>
                <span>æ€»ç”¨æˆ·æ•°</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="studentUsers">0</span>
                <span>å­¦ç”Ÿç”¨æˆ·</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="teacherUsers">0</span>
                <span>æ•™å¸ˆç”¨æˆ·</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="activeUsers">0</span>
                <span>æ´»è·ƒç”¨æˆ·</span>
            </div>
        </div>
        
        <!-- åŠŸèƒ½åŒºåŸŸ -->
        <div class="admin-sections">
            <!-- æ‰¹é‡å¯¼å…¥åŒºåŸŸ -->
            <div class="section-card">
                <h3>ğŸ“¥ æ‰¹é‡å¯¼å…¥è´¦å·</h3>
                
                <div class="import-format">
                    <strong>å¯¼å…¥æ ¼å¼è¯´æ˜ï¼š</strong><br>
                    æ¯è¡Œä¸€ä¸ªè´¦å·ï¼Œæ ¼å¼ï¼š<code>å­¦å·,å§“å,ç­çº§,åˆå§‹å¯†ç (å¯é€‰)</code><br>
                    <strong>ç¤ºä¾‹ï¼š</strong><br>
                    <code>2023001,å¼ ä¸‰,é«˜ä¸€(1)ç­,123456</code><br>
                    <code>2023002,æå››,é«˜ä¸€(1)ç­</code> (é»˜è®¤å¯†ç ï¼š123456)<br>
                    <code>teacher01,å¼ è€å¸ˆ,æŒ‡å¯¼æ•™å¸ˆ,teacher123</code>
                </div>
                
                <textarea id="importData" placeholder="è¯·æŒ‰ç…§ä¸Šè¿°æ ¼å¼è¾“å…¥è´¦å·ä¿¡æ¯..."></textarea>
                
                <div class="quick-actions">
                    <button class="quick-btn" onclick="generateSampleData()">ç”Ÿæˆç¤ºä¾‹æ•°æ®</button>
                    <button class="quick-btn" onclick="clearImportData()">æ¸…ç©ºè¾“å…¥</button>
                    <button class="quick-btn" onclick="showFormatHelp()">æ ¼å¼å¸®åŠ©</button>
                </div>
                
                <div>
                    <button class="btn btn-success" onclick="importAccounts()">âœ… å¯¼å…¥è´¦å·</button>
                    <button class="btn btn-warning" onclick="validateImportData()">ğŸ” éªŒè¯æ•°æ®</button>
                </div>
                
                <div id="importMessage" class="message"></div>
            </div>
            
            <!-- ç”¨æˆ·ç®¡ç†åŒºåŸŸ -->
            <div class="section-card">
                <h3>ğŸ‘¥ ç”¨æˆ·è´¦å·ç®¡ç†</h3>
                
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="æœç´¢å­¦å·ã€å§“åæˆ–ç­çº§..." onkeyup="searchUsers()">
                </div>
                
                <div class="quick-actions">
                    <button class="btn btn-success" onclick="exportUsersToCSV()">ğŸ“Š å¯¼å‡ºCSV</button>
                    <button class="btn" onclick="backupUsers()">ğŸ’¾ å¤‡ä»½æ•°æ®</button>
                    <button class="btn btn-warning" onclick="resetAllPasswords()">ğŸ”„ é‡ç½®æ‰€æœ‰å¯†ç </button>
                    <button class="btn btn-danger" onclick="deleteAllUsers()">ğŸ—‘ï¸ åˆ é™¤æ‰€æœ‰ç”¨æˆ·</button>
                </div>
                
                <div class="user-list" id="userList">
                    <!-- ç”¨æˆ·åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
            <!-- å•ä¸ªè´¦å·æ“ä½œåŒºåŸŸ -->
            <div class="section-card">
                <h3>â• å•ä¸ªè´¦å·æ“ä½œ</h3>
                
                <div class="form-group">
                    <label>å­¦å·/è´¦å·ï¼š</label>
                    <input type="text" id="singleUsername" placeholder="è¯·è¾“å…¥å­¦å·æˆ–è´¦å·">
                </div>
                
                <div class="form-group">
                    <label>å§“åï¼š</label>
                    <input type="text" id="singleName" placeholder="è¯·è¾“å…¥å§“å">
                </div>
                
                <div class="form-group">
                    <label>ç­çº§/èº«ä»½ï¼š</label>
                    <input type="text" id="singleGrade" placeholder="ä¾‹å¦‚ï¼šé«˜ä¸€(1)ç­ æˆ– æŒ‡å¯¼æ•™å¸ˆ">
                </div>
                
                <div class="form-group">
                    <label>å¯†ç ï¼š</label>
                    <input type="text" id="singlePassword" placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆé»˜è®¤ï¼š123456ï¼‰" value="123456">
                </div>
                
                <div class="quick-actions">
                    <button class="btn btn-success" onclick="addSingleUser()">âœ… æ·»åŠ ç”¨æˆ·</button>
                    <button class="btn" onclick="findUser()">ğŸ” æŸ¥æ‰¾ç”¨æˆ·</button>
                    <button class="btn btn-warning" onclick="updateUser()">âœï¸ æ›´æ–°ä¿¡æ¯</button>
                    <button class="btn btn-danger" onclick="deleteUser()">ğŸ—‘ï¸ åˆ é™¤ç”¨æˆ·</button>
                    <button class="btn" onclick="resetUserPassword()">ğŸ”„ é‡ç½®å¯†ç </button>
                </div>
                
                <div id="singleUserMessage" class="message"></div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let allUsers = {};
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ç®¡ç†å‘˜é¢æ¿åˆå§‹åŒ–...');
            initializeAdminPanel();
        });
        
        function initializeAdminPanel() {
            // æ˜¾ç¤ºç®¡ç†å‘˜ä¿¡æ¯
            displayAdminInfo();
            
            // åŠ è½½ç”¨æˆ·æ•°æ®
            loadUsers();
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateStats();
            
            // æ˜¾ç¤ºç™»å½•æ—¶é—´
            document.getElementById('loginTime').textContent = new Date().toLocaleString();
            
            console.log('ç®¡ç†å‘˜é¢æ¿åˆå§‹åŒ–å®Œæˆ');
        }
        
        // æ˜¾ç¤ºç®¡ç†å‘˜ä¿¡æ¯
        function displayAdminInfo() {
            const adminUser = JSON.parse(sessionStorage.getItem('adminUser') || '{"name":"ç®¡ç†å‘˜"}');
            document.getElementById('adminWelcome').textContent = `æ¬¢è¿ï¼Œ${adminUser.name}`;
            document.getElementById('mainWelcome').textContent = `${adminUser.name}çš„æ§åˆ¶å°`;
        }
        
        // åŠ è½½ç”¨æˆ·æ•°æ®
        function loadUsers() {
            console.log('åŠ è½½ç”¨æˆ·æ•°æ®...');
            
            // ä»localStorageåŠ è½½æ³¨å†Œç”¨æˆ·
            const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '{}');
            
            // é¢„è®¾ä¸€äº›ç¤ºä¾‹ç”¨æˆ·ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ç”¨æˆ·æ•°æ®ï¼‰
            if (Object.keys(registeredUsers).length === 0) {
                console.log('æ²¡æœ‰æ‰¾åˆ°ç”¨æˆ·æ•°æ®ï¼Œåˆ›å»ºç¤ºä¾‹æ•°æ®...');
                allUsers = createSampleUsers();
                localStorage.setItem('registeredUsers', JSON.stringify(allUsers));
            } else {
                allUsers = registeredUsers;
            }
            
            displayUserList();
            console.log('ç”¨æˆ·æ•°æ®åŠ è½½å®Œæˆï¼Œæ€»æ•°:', Object.keys(allUsers).length);
        }
        
        // åˆ›å»ºç¤ºä¾‹ç”¨æˆ·æ•°æ®
        function createSampleUsers() {
            return {
                '2023001': { 
                    password: '123456', 
                    name: 'å¼ ä¸‰', 
                    grade: 'é«˜ä¸€(1)ç­',
                    role: 'student',
                    registerTime: new Date().toLocaleString()
                },
                '2023002': { 
                    password: '123456', 
                    name: 'æå››', 
                    grade: 'é«˜ä¸€(1)ç­',
                    role: 'student',
                    registerTime: new Date().toLocaleString()
                },
                '2023003': { 
                    password: '123456', 
                    name: 'ç‹äº”', 
                    grade: 'é«˜ä¸€(2)ç­',
                    role: 'student',
                    registerTime: new Date().toLocaleString()
                },
                'teacher01': { 
                    password: 'teacher123', 
                    name: 'å¼ è€å¸ˆ', 
                    grade: 'æŒ‡å¯¼æ•™å¸ˆ',
                    role: 'teacher',
                    registerTime: new Date().toLocaleString()
                }
            };
        }
        
        // æ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨
        function displayUserList(filteredUsers = null) {
            const usersToShow = filteredUsers || allUsers;
            const userList = document.getElementById('userList');
            
            if (Object.keys(usersToShow).length === 0) {
                userList.innerHTML = '<div class="user-item" style="text-align: center; color: #999;">æš‚æ— ç”¨æˆ·æ•°æ®</div>';
                return;
            }
            
            userList.innerHTML = Object.keys(usersToShow).map(username => {
                const user = usersToShow[username];
                return `
                    <div class="user-item">
                        <div class="user-info">
                            <strong>${username}</strong> - ${user.name} (${user.grade})
                            ${user.role === 'teacher' ? '<span style="color: #e74c3c; margin-left: 10px;">[æ•™å¸ˆ]</span>' : ''}
                            ${user.role === 'admin' ? '<span style="color: #3498db; margin-left: 10px;">[ç®¡ç†å‘˜]</span>' : ''}
                            <br>
                            <small style="color: #95a5a6;">æ³¨å†Œæ—¶é—´: ${user.registerTime || 'æœªçŸ¥'}</small>
                        </div>
                        <div class="user-actions">
                            <button class="action-btn" style="background: #3498db; color: white;" 
                                    onclick="editUser('${username}')">ç¼–è¾‘</button>
                            <button class="action-btn" style="background: #e74c3c; color: white;" 
                                    onclick="deleteSingleUser('${username}')">åˆ é™¤</button>
                            <button class="action-btn" style="background: #f39c12; color: white;" 
                                    onclick="resetSinglePassword('${username}')">é‡ç½®å¯†ç </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const studentCount = Object.values(allUsers).filter(user => user.role === 'student').length;
            const teacherCount = Object.values(allUsers).filter(user => user.role === 'teacher' || user.role === 'admin').length;
            
            document.getElementById('totalUsers').textContent = Object.keys(allUsers).length;
            document.getElementById('studentUsers').textContent = studentCount;
            document.getElementById('teacherUsers').textContent = teacherCount;
            document.getElementById('activeUsers').textContent = Object.keys(allUsers).length; // ç®€åŒ–å¤„ç†
        }
        
        // æ‰¹é‡å¯¼å…¥è´¦å·
        function importAccounts() {
            const importData = document.getElementById('importData').value.trim();
            if (!importData) {
                showMessage('è¯·è¾“å…¥è¦å¯¼å…¥çš„è´¦å·æ•°æ®ï¼', 'error', 'importMessage');
                return;
            }
            
            const lines = importData.split('\n').filter(line => line.trim());
            let successCount = 0;
            let errorCount = 0;
            const errors = [];
            
            lines.forEach((line, index) => {
                const parts = line.split(',').map(part => part.trim());
                if (parts.length >= 3) {
                    const [username, name, grade, password = '123456'] = parts;
                    
                    if (!allUsers[username]) {
                        allUsers[username] = {
                            password: password,
                            name: name,
                            grade: grade,
                            role: grade.includes('æ•™å¸ˆ') || grade.includes('è€å¸ˆ') || grade.includes('æŒ‡å¯¼') ? 'teacher' : 'student',
                            registerTime: new Date().toLocaleString(),
                            importTime: new Date().toLocaleString()
                        };
                        successCount++;
                    } else {
                        errorCount++;
                        errors.push(`ç¬¬${index + 1}è¡Œ: è´¦å· ${username} å·²å­˜åœ¨`);
                    }
                } else {
                    errorCount++;
                    errors.push(`ç¬¬${index + 1}è¡Œ: æ ¼å¼é”™è¯¯ï¼Œéœ€è¦è‡³å°‘3ä¸ªå­—æ®µï¼ˆå­¦å·,å§“å,ç­çº§ï¼‰`);
                }
            });
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('registeredUsers', JSON.stringify(allUsers));
            
            let message = `å¯¼å…¥å®Œæˆï¼æˆåŠŸ: ${successCount}ä¸ª, å¤±è´¥: ${errorCount}ä¸ª`;
            let messageType = 'success';
            
            if (errorCount > 0) {
                messageType = 'warning';
                message += '<br><br>é”™è¯¯è¯¦æƒ…:<br>' + errors.join('<br>');
            }
            
            if (successCount > 0) {
                message += '<br><br>âœ… æ•°æ®å·²ä¿å­˜åˆ°ç³»ç»Ÿ';
            }
            
            showMessage(message, messageType, 'importMessage');
            
            // æ›´æ–°æ˜¾ç¤º
            displayUserList();
            updateStats();
        }
        
        // æœç´¢ç”¨æˆ·
        function searchUsers() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (!searchTerm) {
                displayUserList();
                return;
            }
            
            const filteredUsers = {};
            Object.keys(allUsers).forEach(username => {
                const user = allUsers[username];
                if (username.toLowerCase().includes(searchTerm) ||
                    user.name.toLowerCase().includes(searchTerm) ||
                    user.grade.toLowerCase().includes(searchTerm)) {
                    filteredUsers[username] = user;
                }
            });
            
            displayUserList(filteredUsers);
        }
        
        // ç”Ÿæˆç¤ºä¾‹æ•°æ®
        function generateSampleData() {
            const sampleData = `2023001,å¼ ä¸‰,é«˜ä¸€(1)ç­,123456
2023002,æå››,é«˜ä¸€(1)ç­
2023003,ç‹äº”,é«˜ä¸€(2)ç­
2023004,èµµå…­,é«˜ä¸€(3)ç­
teacher01,å¼ è€å¸ˆ,æŒ‡å¯¼æ•™å¸ˆ,teacher123
teacher02,æè€å¸ˆ,æŠ€æœ¯é¡¾é—®,teacher123`;
            
            document.getElementById('importData').value = sampleData;
            showMessage('ç¤ºä¾‹æ•°æ®å·²ç”Ÿæˆï¼Œè¯·æ£€æŸ¥åç‚¹å‡»"å¯¼å…¥è´¦å·"', 'success', 'importMessage');
        }
        
        // æ¸…ç©ºè¾“å…¥
        function clearImportData() {
            document.getElementById('importData').value = '';
            showMessage('è¾“å…¥æ¡†å·²æ¸…ç©º', 'success', 'importMessage');
        }
        
        // æ˜¾ç¤ºæ ¼å¼å¸®åŠ©
        function showFormatHelp() {
            const helpText = `ğŸ“‹ æ ¼å¼å¸®åŠ©ï¼š
â€¢ æ¯è¡Œä¸€ä¸ªè´¦å·ï¼Œç”¨é€—å·åˆ†éš”
â€¢ å¿…éœ€å­—æ®µï¼šå­¦å·,å§“å,ç­çº§
â€¢ å¯é€‰å­—æ®µï¼šå¯†ç ï¼ˆä¸å¡«åˆ™é»˜è®¤ä¸º123456ï¼‰
â€¢ ç¤ºä¾‹ï¼š2023001,å¼ ä¸‰,é«˜ä¸€(1)ç­,123456
â€¢ æ•™å¸ˆè´¦å·ä¼šåœ¨ç­çº§ä¸­åŒ…å«"æ•™å¸ˆ"ã€"è€å¸ˆ"ã€"æŒ‡å¯¼"ç­‰å­—æ ·æ—¶è‡ªåŠ¨è¯†åˆ«`;
            
            showMessage(helpText, 'success', 'importMessage');
        }
        
        // éªŒè¯å¯¼å…¥æ•°æ®
        function validateImportData() {
            const importData = document.getElementById('importData').value.trim();
            if (!importData) {
                showMessage('è¯·è¾“å…¥è¦éªŒè¯çš„æ•°æ®ï¼', 'error', 'importMessage');
                return;
            }
            
            const lines = importData.split('\n').filter(line => line.trim());
            let validCount = 0;
            let invalidCount = 0;
            const results = [];
            
            lines.forEach((line, index) => {
                const parts = line.split(',').map(part => part.trim());
                if (parts.length >= 3) {
                    validCount++;
                    results.push(`ç¬¬${index + 1}è¡Œ: âœ… æ ¼å¼æ­£ç¡®`);
                } else {
                    invalidCount++;
                    results.push(`ç¬¬${index + 1}è¡Œ: âŒ æ ¼å¼é”™è¯¯ï¼Œéœ€è¦è‡³å°‘3ä¸ªå­—æ®µ`);
                }
            });
            
            const message = `éªŒè¯ç»“æœï¼šæœ‰æ•ˆ ${validCount} è¡Œï¼Œæ— æ•ˆ ${invalidCount} è¡Œ<br><br>${results.join('<br>')}`;
            showMessage(message, invalidCount === 0 ? 'success' : 'warning', 'importMessage');
        }
        
        // æ·»åŠ å•ä¸ªç”¨æˆ·
        function addSingleUser() {
            const username = document.getElementById('singleUsername').value.trim();
            const name = document.getElementById('singleName').value.trim();
            const grade = document.getElementById('singleGrade').value.trim();
            const password = document.getElementById('singlePassword').value.trim() || '123456';
            
            if (!username || !name || !grade) {
                showMessage('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯ï¼', 'error', 'singleUserMessage');
                return;
            }
            
            if (allUsers[username]) {
                showMessage('è¯¥è´¦å·å·²å­˜åœ¨ï¼', 'error', 'singleUserMessage');
                return;
            }
            
            allUsers[username] = {
                password: password,
                name: name,
                grade: grade,
                role: grade.includes('æ•™å¸ˆ') || grade.includes('è€å¸ˆ') || grade.includes('æŒ‡å¯¼') ? 'teacher' : 'student',
                registerTime: new Date().toLocaleString()
            };
            
            localStorage.setItem('registeredUsers', JSON.stringify(allUsers));
            showMessage(`ç”¨æˆ· ${username} æ·»åŠ æˆåŠŸï¼`, 'success', 'singleUserMessage');
            clearSingleForm();
            displayUserList();
            updateStats();
        }
        
        // æŸ¥æ‰¾ç”¨æˆ·
        function findUser() {
            const username = document.getElementById('singleUsername').value.trim();
            if (!username) {
                showMessage('è¯·è¾“å…¥è¦æŸ¥æ‰¾çš„è´¦å·ï¼', 'error', 'singleUserMessage');
                return;
            }
            
            if (allUsers[username]) {
                const user = allUsers[username];
                document.getElementById('singleName').value = user.name;
                document.getElementById('singleGrade').value = user.grade;
                document.getElementById('singlePassword').value = '';
                showMessage(`æ‰¾åˆ°ç”¨æˆ·ï¼š${user.name} (${user.grade})`, 'success', 'singleUserMessage');
            } else {
                showMessage('ç”¨æˆ·ä¸å­˜åœ¨ï¼', 'error', 'singleUserMessage');
            }
        }
        
        // åˆ é™¤ç”¨æˆ·
        function deleteUser() {
            const username = document.getElementById('singleUsername').value.trim();
            if (!username) {
                showMessage('è¯·è¾“å…¥è¦åˆ é™¤çš„è´¦å·ï¼', 'error', 'singleUserMessage');
                return;
            }
            
            if (allUsers[username]) {
                if (confirm(`ç¡®å®šè¦åˆ é™¤ç”¨æˆ· ${username} - ${allUsers[username].name} å—ï¼Ÿ`)) {
                    delete allUsers[username];
                    localStorage.setItem('registeredUsers', JSON.stringify(allUsers));
                    showMessage('ç”¨æˆ·åˆ é™¤æˆåŠŸï¼', 'success', 'singleUserMessage');
                    clearSingleForm();
                    displayUserList();
                    updateStats();
                }
            } else {
                showMessage('ç”¨æˆ·ä¸å­˜åœ¨ï¼', 'error', 'singleUserMessage');
            }
        }
        
        // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
        function updateUser() {
            const username = document.getElementById('singleUsername').value.trim();
            const name = document.getElementById('singleName').value.trim();
            const grade = document.getElementById('singleGrade').value.trim();
            const password =
